generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

<<<<<<< Updated upstream
=======
model user {
  user_id            Int                 @id @default(autoincrement())
  picture_url        String?
  full_name          String
  password           String
  cpf                String
  email              String              @unique
  created_at         DateTime            @default(now())
  updated_at         DateTime            @default(now())
  user_project_roles user_project_role[]
  time_records       time_record[]
  projects           project[]
}

model project {
  project_id               Int                 @id @default(autoincrement())
  project_name             String              @unique
  project_description      String              @default("")
  owner_id                 Int
  location_required        Boolean
  location                 String?
  timezone                 String
  commercial_time_required Boolean
  commercial_time_start    Int?
  commercial_time_end      Int?
  users_count              Int                 @default(0)
  created_at               DateTime            @default(now())
  updated_at               DateTime            @default(now())
  owner                    user                @relation(fields: [owner_id], references: [user_id])
  user_project_roles       user_project_role[]
  time_records             time_record[]
}
>>>>>>> Stashed changes

enum UserRole {
  ADMIN
  MANAGER
  USER
}

enum TimeRecordJustificationStatus {
  APPROVED
  PENDING
  DENIED
  CANCELLED
}

enum JustificationType {
  CHECKIN
  CHECKOUT
}

model user {
  id            Int                 @id @default(autoincrement())
  full_name          String
  password           String
  email              String              @unique
  created_at         DateTime            @default(now())
  updated_at         DateTime            @default(now())
  user_project_roles user_project_role[]
  time_records       time_record[]
  time_records_justifications    time_record_justification[]  @relation(name: "time_record_justification_user_colaborator_fk")
  time_record_justifications    time_record_justification?  @relation(name: "time_record_justification_user_approver_fk")
}


model project {
  id               Int                 @id @default(autoincrement())
  project_name             String      @unique
  location_required        Boolean
  location                 String?
  timezone                 String
  commercial_time_required Boolean
  commercial_time_start    Int?
  commercial_time_end      Int?
  created_at               DateTime            @default(now())
  updated_at               DateTime            @default(now())
  user_project_roles       user_project_role[]
  time_records             time_record[]
  time_records_justifications time_record_justification[] 
}


model user_project_role {
  id Int      @id @default(autoincrement())
  user_id              Int
  project_id           Int
  role                 UserRole
  hours_per_week       Int
  created_at           DateTime @default(now())
  updated_at           DateTime @default(now())
  user                 user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  project              project  @relation(fields: [project_id], references: [id])

  @@unique([user_id, project_id]) // A single user record per project
}

model time_record {
  id      Int                @id @default(autoincrement())
  user_id             Int
  project_id          Int
  check_in_timestamp  DateTime           @default(now())
  check_out_timestamp DateTime?
  location            String?
  created_at          DateTime           @default(now())
  updated_at          DateTime           @default(now())
  user                user               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  project             project            @relation(fields: [project_id], references: [id])
  absense_documents   absense_document[]
}

model absense_document {
  id Int         @id @default(autoincrement())
  document_file       Bytes
  file_name String
  time_record_justification_id Int @unique()
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  time_record_justification time_record_justification @relation(fields: [time_record_justification_id], references: [id])
}


model time_record_justification {
  id Int @id @default(autoincrement())
  colaborator_id Int 
  approver_id Int? @unique()
  project_id Int
  time_record_id Int
  status TimeRecordJustificationStatus
  user_message        String?
  manager_message     String?
  justification_type JustificationType
  timestamp DateTime
  updated_location String?
  absense_document absense_document?
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) 
  colaborator user @relation(name: "time_record_justification_user_colaborator_fk", fields: [colaborator_id], references: [id])
  approver user? @relation(name: "time_record_justification_user_approver_fk", fields: [approver_id], references: [id])
  project project @relation(fields: [project_id], references: [id])
  time_record time_record @relation(fields: [time_record_id], references: [id])
  @@unique([approver_id, id])
  @@unique([time_record_id, id])
 }

